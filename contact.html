<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ - Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø°Ø§ØªÙŠ</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* ÙˆØ§Ø¬Ù‡Ø© Ù…Ø­Ø§Ø¯Ø«Ø© */
    .chat-wrap { max-width: 980px; margin: 20px auto; padding: 0 12px; }
    .chat-card { background:#ffffffdb; border:1px solid #dfe7e2; border-radius:12px; padding:0; overflow:hidden; box-shadow:0 3px 10px rgba(0,0,0,.05) }
    .chat-header { padding:14px; background:#e9f5ef; color:#0a6a3b; font-weight:800; display:flex; align-items:center; gap:10px }
    .chat-body { padding:16px; max-height:60vh; overflow:auto; background:rgba(255,255,255,.85) }
    .msg { margin:8px 0; display:flex; }
    .msg.bot { justify-content:flex-start; }
    .msg.me { justify-content:flex-end; }
    .bubble { max-width:80%; padding:10px 12px; border-radius:12px; line-height:1.6; white-space:pre-wrap }
    .bot .bubble { background:#f2f7f4; border:1px solid #dfe7e2; color:#254335 }
    .me  .bubble { background:#0a6a3b; color:#fff }
    .chat-footer { padding:12px; background:#fff; border-top:1px solid #eef2ef; display:flex; gap:8px; align-items:center }
    .chat-footer input { flex:1; padding:10px; border:1px solid #c8d8cf; border-radius:8px; }
    .quick { display:flex; gap:8px; flex-wrap:wrap; margin:8px 16px 16px }
    .quick .btn { background:#ffffff; color:#0a6a3b; border:1px solid #cfe2d8; padding:8px 10px; border-radius:8px; cursor:pointer; }
    .quick .btn:hover { background:#e9f5ef }
    /* ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ */
    body.dark-mode .chat-card{ background:#1c1c1c; border-color:#333 }
    body.dark-mode .chat-header{ background:#2b2b2b; color:#fff }
    body.dark-mode .chat-body{ background:#1f1f1f }
    body.dark-mode .bot .bubble{ background:#27302c; border-color:#333; color:#dfe7e2 }
    body.dark-mode .me .bubble{ background:#0a6a3b; color:#fff }
    body.dark-mode .chat-footer{ background:#1c1c1c; border-color:#333 }
    body.dark-mode .quick .btn{ background:#2b2b2b; color:#a7e3c6; border-color:#333 }
  </style>
</head>
<body>
  <header>
    <img src="assets/logo.jpg" alt="Ø´Ø¹Ø§Ø± Ø£Ù…Ø§Ù†Ø© Ù…Ù†Ø·Ù‚Ø© Ø­Ø§Ø¦Ù„" class="logo" />
    <h1>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ - Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø°Ø§ØªÙŠ</h1>
  </header>

  <nav class="nav">
    <a href="request.html">Ø±ÙØ¹ Ø·Ù„Ø¨</a>
    <a href="track.html">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
    <a href="profile.html">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
    <a href="contact.html" class="active">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ (Ù…Ø­Ø§Ø¯Ø«Ø©)</a>
    <a href="faq.html">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</a>
  </nav>

  <main class="chat-wrap">
    <section class="chat-card">
      <div class="chat-header">ğŸ¤– Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØªÙˆØ§ØµÙ„</div>

      <div id="chatBody" class="chat-body"></div>
      <div class="quick" id="quickArea"></div>

      <div class="chat-footer">
        <input id="chatInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." />
        <button class="btn" id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
        <button class="btn" id="darkBtn">ğŸŒ“</button>
      </div>
    </section>
  </main>

  <footer><p>Â© Ø£Ù…Ø§Ù†Ø© Ù…Ù†Ø·Ù‚Ø© Ø­Ø§Ø¦Ù„</p></footer>

  <!-- ØªØ£ÙƒØ¯ Ø£Ù† app.js Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯ ÙˆÙŠØ­ØªÙˆÙŠ toggleDarkMode ÙˆØ­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø§Øª -->
  <script src="app.js" defer></script>
  <script>
    (function(){
      "use strict";

      var chatBody  = document.getElementById('chatBody');
      var chatInput = document.getElementById('chatInput');
      var sendBtn   = document.getElementById('sendBtn');
      var quickArea = document.getElementById('quickArea');
      var darkBtn   = document.getElementById('darkBtn');

      // Ø­Ø§Ù„Ø© Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¬Ù…Ù‘Ø¹Ø©
      var state = {
        step: "idle",          // idle, needNumber, needType, needPlace, needDesc, needDays, done
        ticket: {
          requestNumber: "",
          type: "",     // Ø´ÙƒÙˆÙ‰ / Ø§Ù‚ØªØ±Ø§Ø­
          place: "",
          desc: "",
          daysSince: null
        }
      };

      var QUICK_HOME = [
        {text:'Ø¨Ø¯Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨', intent:'start_follow'},
        {text:'Ø±ÙØ¹ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯', intent:'raise'},
        {text:'Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ø§ØªÙŠ', intent:'track'},
        {text:'Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©', intent:'faq'},
        {text:'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„', intent:'info'}
      ];

      function addMsg(text, who){
        var row = document.createElement('div');
        row.className = 'msg ' + (who === 'me' ? 'me' : 'bot');
        var b = document.createElement('div');
        b.className = 'bubble';
        b.textContent = text;
        row.appendChild(b);
        chatBody.appendChild(row);
        chatBody.scrollTop = chatBody.scrollHeight;

        // Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        var log = [];
        try { log = JSON.parse(localStorage.getItem('chatLog_contact') || '[]'); } catch(_){}
        log.push({who: who || 'bot', text: text, ts: Date.now()});
        localStorage.setItem('chatLog_contact', JSON.stringify(log));
      }

      function setQuick(options){
        quickArea.innerHTML = '';
        options.forEach(function(opt){
          var btn = document.createElement('button');
          btn.className = 'btn';
          btn.textContent = opt.text;
          btn.addEventListener('click', function(){ handleIntent(opt.intent); });
          quickArea.appendChild(btn);
        });
      }

      function resetFlow(){
        state.step = "idle";
        state.ticket = { requestNumber:"", type:"", place:"", desc:"", daysSince:null };
      }

      function handleIntent(intent){
        if (intent === 'raise') {
          addMsg('Ø³ÙŠØªÙ… ÙØªØ­ ØµÙØ­Ø© Ø±ÙØ¹ Ø§Ù„Ø·Ù„Ø¨â€¦', 'bot');
          window.location.href = 'request.html';
          return;
        }
        if (intent === 'track') {
          addMsg('Ø³ÙŠØªÙ… ÙØªØ­ ØµÙØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øªâ€¦', 'bot');
          window.location.href = 'track.html';
          return;
        }
        if (intent === 'faq') {
          addMsg('Ø³ÙŠØªÙ… ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©â€¦', 'bot');
          window.location.href = 'faq.html';
          return;
        }
        if (intent === 'info') {
          addMsg('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„:\nâ€¢ Ø§Ù„Ù‡Ø§ØªÙ: 199040\nâ€¢ Ø§Ù„Ø¨Ø±ÙŠØ¯: support@hail.gov.sa\nâ€¢ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„: 8Øµâ€“2Ù… (Ø§Ù„Ø£Ø­Ø¯â€“Ø§Ù„Ø®Ù…ÙŠØ³)', 'bot');
          setQuick(QUICK_HOME);
          return;
        }
        if (intent === 'cancel') {
          addMsg('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©. Ù…Ø§Ø°Ø§ ØªÙˆØ¯ Ø£Ù† ØªÙØ¹Ù„ØŸ', 'bot');
          resetFlow();
          setQuick(QUICK_HOME);
          return;
        }
        if (intent === 'start_follow') {
          resetFlow();
          state.step = "needNumber";
          addMsg('ÙØ¶Ù„Ø§Ù‹ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ (6 Ø£Ø±Ù‚Ø§Ù…).', 'bot');
          setQuick([{text:'Ø¥Ù„ØºØ§Ø¡', intent:'cancel'}]);
          return;
        }

        // ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ
        addMsg('Ø§Ø®ØªØ± Ù…Ù†: Ø¨Ø¯Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨ / Ø±ÙØ¹ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ / Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ø§ØªÙŠ / Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© / Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„.', 'bot');
        setQuick(QUICK_HOME);
      }

      function parseDaysFromCreatedAt(createdAt){
        try{
          var created = new Date(createdAt);
          var now = new Date();
          var diffMs = now - created;
          var days = Math.floor(diffMs / (1000*60*60*24));
          if (days < 0 || isNaN(days)) return null;
          return days;
        }catch(_){ return null; }
      }

      function checkRequestAgeByNumber(reqNo){
        var list = [];
        try { list = JSON.parse(localStorage.getItem('requests') || '[]'); } catch(_){}
        var found = list.find(function(r){ return r.requestNumber === reqNo; });
        if (!found) return null;
        var d = parseDaysFromCreatedAt(found.createdAt);
        return (d == null ? null : {days:d, req:found});
      }

      function finalizeTicket(){
        // Ø­ÙØ¸ Ø§Ù„ØªØ°ÙƒØ±Ø© Ø§Ù„Ù…Ø¬Ù…Ù‘Ø¹Ø©
        var store = [];
        try { store = JSON.parse(localStorage.getItem('contactTickets') || '[]'); } catch(_){}
        store.push({
          ...state.ticket,
          createdAt: new Date().toISOString()
        });
        localStorage.setItem('contactTickets', JSON.stringify(store));

        // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø­Ø³Ø¨ Ø§Ù„Ø£ÙŠØ§Ù…
        var d = state.ticket.daysSince;
        if (typeof d === 'number' && d >= 7) {
          addMsg('Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„Ø·Ù„Ø¨ Ù„Ù‡ 7 Ø£ÙŠØ§Ù… Ø£Ùˆ Ø£ÙƒØ«Ø±ØŒ Ø³ÙŠØªÙ… ØªÙˆØ§ØµÙ„ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ù…Ø¹Ùƒ Ø®Ù„Ø§Ù„ Ø¯Ù‚Ø§Ø¦Ù‚. Ø´ÙƒØ±Ù‹Ø§ Ù„ØµØ¨Ø±Ùƒ.', 'bot');
        } else {
          addMsg('Ù…Ø¯Ø© Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ù§ Ø£ÙŠØ§Ù… ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ù…Ø¯Ø©ØŒ ÙˆØ³Ù†ÙˆØ§ÙÙŠÙƒ Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª.', 'bot');
        }

        setQuick(QUICK_HOME);
        state.step = "done";
      }

      function handleUserText(text){
        var t = (text || '').trim();
        if (!t) return;

        // Ø®Ø·ÙˆØ§Øª Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (state.step === "needNumber") {
          // Ø­ÙØ¸ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨
          state.ticket.requestNumber = t;
          var auto = checkRequestAgeByNumber(t);
          if (auto && typeof auto.days === 'number') {
            state.ticket.daysSince = auto.days;
            // Ù…Ø¨Ø§Ø´Ø±Ø© Ù†Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨
            state.step = "needType";
            addMsg('Ù…Ø§ Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨ØŸ (Ø§ÙƒØªØ¨: Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­)', 'bot');
            setQuick([{text:'Ø´ÙƒÙˆÙ‰', intent:'type_complaint'}, {text:'Ø§Ù‚ØªØ±Ø§Ø­', intent:'type_suggestion'}, {text:'Ø¥Ù„ØºØ§Ø¡', intent:'cancel'}]);
          } else {
            // Ù…Ø§ Ø¹Ø±ÙÙ†Ø§Ù‡ Ù…Ù† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©Ø› Ø³Ù†Ø³Ø£Ù„Ùƒ Ø¹Ù† Ø£ÙŠØ§Ù… Ø§Ù„Ø±ÙØ¹ Ù„Ø§Ø­Ù‚Ø§Ù‹
            state.step = "needType";
            addMsg('Ù…Ø§ Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨ØŸ (Ø§ÙƒØªØ¨: Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­)', 'bot');
            setQuick([{text:'Ø´ÙƒÙˆÙ‰', intent:'type_complaint'}, {text:'Ø§Ù‚ØªØ±Ø§Ø­', intent:'type_suggestion'}, {text:'Ø¥Ù„ØºØ§Ø¡', intent:'cancel'}]);
          }
          return;
        }

        if (state.step === "needType") {
          var low = t.toLowerCase();
          if (low.indexOf('Ø´Ùƒ') !== -1) { state.ticket.type = 'Ø´ÙƒÙˆÙ‰'; }
          else if (low.indexOf('Ø§Ù‚Øª') !== -1 || low.indexOf('Ø§Ù‚ØªØ±Ø§Ø­') !== -1) { state.ticket.type = 'Ø§Ù‚ØªØ±Ø§Ø­'; }
          else { addMsg('ÙØ¶Ù„Ø§Ù‹ Ø§ÙƒØªØ¨ "Ø´ÙƒÙˆÙ‰" Ø£Ùˆ "Ø§Ù‚ØªØ±Ø§Ø­".', 'bot'); return; }

          state.step = "needPlace";
          addMsg('Ø§Ø°ÙƒØ± Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ù…Ø´ÙƒÙ„Ø© (Ø­ÙŠ/Ø´Ø§Ø±Ø¹/Ù…Ø±ÙÙ‚).', 'bot');
          setQuick([{text:'Ø¥Ù„ØºØ§Ø¡', intent:'cancel'}]);
          return;
        }

        if (state.step === "needPlace") {
          state.ticket.place = t;
          state.step = "needDesc";
          addMsg('Ø§ÙƒØªØ¨ ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„.', 'bot');
          setQuick([{text:'Ø¥Ù„ØºØ§Ø¡', intent:'cancel'}]);
          return;
        }

        if (state.step === "needDesc") {
          state.ticket.desc = t;

          // Ù„Ùˆ Ù…Ø§ Ø¹Ø±ÙÙ†Ø§ Ø§Ù„Ø£ÙŠØ§Ù… Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ØŒ Ø§Ø³Ø£Ù„ Ø§Ù„Ø¢Ù†
          if (typeof state.ticket.daysSince === 'number') {
            // Ù„Ø¯ÙŠÙ†Ø§ Ø§Ù„Ø£ÙŠØ§Ù… Ø¨Ø§Ù„ÙØ¹Ù„
            finalizeTicket();
          } else {
            state.step = "needDays";
            addMsg('Ù…Ù†Ø° ÙƒÙ… ÙŠÙˆÙ… Ø±ÙÙØ¹ Ø§Ù„Ø·Ù„Ø¨ØŸ (Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø£ÙŠØ§Ù… ÙÙ‚Ø·)', 'bot');
            setQuick([{text:'Ø¥Ù„ØºØ§Ø¡', intent:'cancel'}]);
          }
          return;
        }

        if (state.step === "needDays") {
          var n = parseInt(t, 10);
          if (isNaN(n) || n < 0) {
            addMsg('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø£ÙŠØ§Ù… ØµØ§Ù„Ø­ (Ù…Ø«Ù„Ø§Ù‹: 3 Ø£Ùˆ 10).', 'bot');
            return;
          }
          state.ticket.daysSince = n;
          finalizeTicket();
          return;
        }

        // Ù„Ùˆ ÙƒÙ†Ø§ Ø®Ø§Ø±Ø¬ Ø§Ù„ØªØ¯ÙÙ‚
        // ÙÙ‡Ù… Ø¨Ø³ÙŠØ· Ù„Ù„ÙƒÙ„Ù…Ø§Øª
        var lowt = t.toLowerCase();
        if (lowt.indexOf('Ù…ØªØ§Ø¨Ø¹') !== -1 || lowt.indexOf('Ø±Ù‚Ù…') !== -1) {
          handleIntent('start_follow'); return;
        }
        if (lowt.indexOf('Ø±ÙØ¹') !== -1 || lowt.indexOf('Ø¬Ø¯ÙŠØ¯') !== -1) {
          handleIntent('raise'); return;
        }
        if (lowt.indexOf('Ø³Ø¤Ø§Ù„') !== -1 || lowt.indexOf('faq') !== -1) {
          handleIntent('faq'); return;
        }
        if (lowt.indexOf('ØªÙˆØ§ØµÙ„') !== -1 || lowt.indexOf('info') !== -1) {
          handleIntent('info'); return;
        }

        // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        addMsg('Ù„ÙØªØ­ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§ÙƒØªØ¨: Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ùˆ Ø§Ø¶ØºØ· "Ø¨Ø¯Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨".', 'bot');
        setQuick(QUICK_HOME);
      }

      // Ù†ÙˆØ§ÙŠØ§ Ø²Ø±Ù‘ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©
      function handleQuickExtra(intent){
        if (intent === 'type_complaint') {
          handleUserText('Ø´ÙƒÙˆÙ‰');
          return;
        }
        if (intent === 'type_suggestion') {
          handleUserText('Ø§Ù‚ØªØ±Ø§Ø­');
          return;
        }
      }

      // Event handlers
      sendBtn.addEventListener('click', function(){
        var txt = chatInput.value.trim();
        if (!txt) return;
        addMsg(txt, 'me');
        handleUserText(txt);
        chatInput.value = '';
      });
      chatInput.addEventListener('keydown', function(e){
        if (e.key === 'Enter') { e.preventDefault(); sendBtn.click(); }
      });

      quickArea.addEventListener('click', function(e){
        if (e.target && e.target.classList.contains('btn')) {
          var label = e.target.textContent || '';
          // Ø®Ø±Ø§Ø¦Ø· intent Ù„Ù„Ø£Ø²Ø±Ø§Ø±
          var map = {
            'Ø¨Ø¯Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨':'start_follow',
            'Ø±ÙØ¹ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯':'raise',
            'Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ø§ØªÙŠ':'track',
            'Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©':'faq',
            'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„':'info',
            'Ø¥Ù„ØºØ§Ø¡':'cancel',
            'Ø´ÙƒÙˆÙ‰':'type_complaint',
            'Ø§Ù‚ØªØ±Ø§Ø­':'type_suggestion'
          };
          var intent = map[label] || 'home';
          if (intent === 'type_complaint' || intent === 'type_suggestion') {
            handleQuickExtra(intent);
          } else {
            handleIntent(intent);
          }
        }
      });

      // Ø²Ø± Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ: Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ app.js Ø¥Ù† ÙˆÙØ¬Ø¯ØŒ ÙˆØ¥Ù„Ø§ Ø¨Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ·
      darkBtn.addEventListener('click', function(){
        if (typeof window.toggleDarkMode === 'function') {
          window.toggleDarkMode();
        } else {
          document.body.classList.toggle('dark-mode');
          try {
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
          } catch(_){}
        }
      });

      // ØªÙ…Ù‡ÙŠØ¯
      (function boot(){
        var old = [];
        try { old = JSON.parse(localStorage.getItem('chatLog_contact') || '[]'); } catch(_){}
        if (old.length) {
          old.forEach(function(m){ addMsg(m.text, m.who); });
        } else {
          addMsg('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! ÙƒÙŠÙ Ù†Ù‚Ø¯Ø± Ù†Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¨Ø§Ù„Ø£Ø³ÙÙ„ Ø£Ùˆ Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ.', 'bot');
        }
        setQuick(QUICK_HOME);
      })();

    })();
  </script>
</body>
</html>
